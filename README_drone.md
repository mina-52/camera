# ドローン検出システム (drone_detection.py)

## 概要

このプログラムは、OBS仮想カメラからのリアルタイム映像に対してYOLOv8モデルを使用したドローン検出を実行します。四分割画面で検出結果を表示し、左上の画像は一秒ごとに自動更新され、エンターキーで一時停止/再開を制御できます。

## 機能

- **OBS仮想カメラからのリアルタイム検出**: OBS仮想カメラの映像に対してYOLOv8モデルでドローン検出を実行
- **四分割画面表示**: 
  - 左上: 一秒ごとに自動更新される検出物体の切り抜き画像（一時停止/再開可能）
  - 右上: リアルタイム検出結果（バウンディングボックス付き）
  - 左下: フレームごとに更新される最新の検出物体画像
  - 右下: 検出座標情報、フレームカウンター、状態表示
- **フルスクリーン表示**: 検出結果をフルスクリーンで表示
- **自動更新機能**: 左上の画像が一秒ごとに自動更新
- **一時停止/再開機能**: エンターキーで左上の更新を一時停止/再開

## 必要なファイル

- `drone_detection.py`: メインプログラム
- `weights.pt`: 学習済みYOLOv8モデルファイル
- OBS Studio（仮想カメラ機能）

## 前提条件

### OBS Studioの設定
1. OBS Studioをインストール
2. OBSで「仮想カメラを開始」を実行
3. 仮想カメラのインデックスが1であることを確認

## インストール

必要なPythonパッケージをインストールしてください：

```bash
pip install opencv-python
pip install ultralytics
pip install numpy
```

## 使用方法

### 基本的な使用方法

```bash
python drone_detection.py
```

OBS仮想カメラ（インデックス1）を使用します。

### OBS仮想カメラの設定

1. **OBS Studioを起動**
2. **仮想カメラを開始**: OBSの「開始」→「仮想カメラを開始」
3. **カメラインデックスの確認**: 必要に応じて`drone_detection.py`の以下の行を変更
   ```python
   cap = cv2.VideoCapture(1)  # 1を適切なインデックスに変更
   ```

## 操作方法

- **エンターキー**: 左上の画像更新を一時停止/再開
  - 再生中に押す: 一時停止
  - 一時停止中に押す: 現在のフレームまで飛ばして再開
- **qキー**: プログラム終了

## 画面レイアウト

```
┌─────────────────┬─────────────────┐
│                 │                 │
│   左上          │   右上          │
│ 一秒ごと        │ リアルタイム    │
│ 自動更新        │ 検出結果        │
│ (一時停止可能)   │                 │
│                 │                 │
├─────────────────┼─────────────────┤
│                 │                 │
│   左下          │   右下          │
│ フレームごと    │ 検出座標        │
│ 最新画像        │ フレーム数      │
│                 │ 状態表示        │
└─────────────────┴─────────────────┘
```

## 表示される情報

### 左上画面
- 一秒ごとに更新される検出物体の切り抜き画像
- 状態表示（"PLAYING" / "PAUSED"）
- 緑色: 再生中、赤色: 一時停止中

### 右下画面
- 検出座標情報
- フレームカウンター
- 現在の状態（再生中/一時停止）

## カメラ設定

- **解像度**: 1280x720
- **フレームレート**: 30FPS
- **カメラインデックス**: 1（OBS仮想カメラ）

## トラブルシューティング

### OBS仮想カメラが開けない場合
- OBSで「仮想カメラを開始」しているか確認
- カメラインデックスが正しいか確認（デフォルト: 1）
- 他のアプリケーションが仮想カメラを使用していないか確認

### モデルファイルが見つからない場合
- `weights.pt`ファイルが同じディレクトリにあるか確認
- モデルファイルのパスが正しいか確認

### 表示が正常でない場合
- OpenCVが正常にインストールされているか確認
- 画面解像度が適切か確認
- OBS仮想カメラが正常に動作しているか確認

## 技術仕様

- **Python**: 3.12.11
- **OpenCV**: 4.10.0
- **Ultralytics**: 8.3.159
- **NumPy**: 2.3.1
- **OBS Studio**: 最新版推奨

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 作者

[yuya nagatomi]

## 更新履歴

- v1.1: 一時停止/再開機能追加
  - 左上の画像を一秒ごとに自動更新
  - エンターキーで一時停止/再開機能
  - フレームカウンターと状態表示追加
- v1.0: 初期リリース
  - OBS仮想カメラからのリアルタイム検出機能
  - 四分割画面表示
  - エンターキーでの手動更新機能 